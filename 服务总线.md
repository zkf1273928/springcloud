##Bus
* 可以实现分布式的自动刷新功能，config和bus搭配使用可以实现配置的动态刷新
* bus支持两种消息代理：RabbitMQ和kafka
* bus是用来将分布式系统的节点与轻量级消息系统链接起来的框架，它整合了java的事件处理机制和消息中间件的功能
* 可以管理和传播分布式系统的消息，就像一个分布式执行器，可用于广播状态更改、事件推送等，也可以当作微服务间的通信通道
######什么是总线？
在微服务加工的系统中，通常会使用轻量级的消息代理来构建一个公用的消息主题，并让系统中所有的微服务实例都链接上来，由于该主题中产生的消息会被所有实例监听和消费，所以他被称为消息总线。在总线上的各个实例，都可以方便的广播一些需要让其他连接在该主题上的实例都知道的信息。
######基本原理
ConfigClient实例都监听MQ中同一个topic(默认是springCloudBus)。当一个服务刷新数据时候，它会把这个信息放入topic中，这样其他监听同一个topic的服务就能得到通知，然后去更新自身的配置。
##RabbitMQ安装
安装之后找到sbin目录执行命令rabbitmq-plugins enable rabbitmq_management
* 有可视化插件
* 访问地址localhost:15672/
* 账号密码默认guest guest
####SpringCloud Bus动态刷新全局广播
* 通知中的服务端3344从而全部通知
在3344服务端需要的步骤
1.引入pom
```xml
<!-- 添加消息总线RabbitMQ支持 -->
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-bus-amqp</artifactId>
</dependency>
```
2.yml
```yaml
##rabbitmq相关配置
rabbitmq:
  host: localhost
  port: 5672
  username: guest
  password: guest
##rabbitmq相关配置，暴露bus刷新配置的端点
management:
  endpoints: #暴露bus刷新配置的端点
  web:
    exposure:
      include: 'bus-refresh'
```
在3355，3366服客户端
1.引入pom
```xml
<!-- 添加消息总线RabbitMQ支持 -->
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-bus-amqp</artifactId>
</dependency>
```
2.yml
```yaml
##rabbitmq相关配置 15672是web管理界面端口，5672是MQ访问的端口
spring:
  rabbitmq:
    host: localhost
    port: 5672
    username: guest
    password: guest
```
3.运维发送post请求刷新客户端
* curl -X POST "http://localhost:3344/actuator/bus-refresh"
* 一次发送，3355，3366客户端全部生效唤醒
####SpringCloud Bus动态刷新定点通知
* curl -X POST "http://localhost:3344/actuator/bus-refresh/{destination}"
* 通过destination参数类指定需要更新配置的服务或实例
实例
* curl -X POST "http://localhost:3344/actuator/bus-refresh/config-client:3355"
